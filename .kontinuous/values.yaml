app:
  ~chart: app
  ~needs: [build-app]
  imagePackage: app
  envFrom:
  - secretRef:
      name: carnets-configmap

hasura:
  ~chart: hasura
  ~needs: [build-hasura]
  imagePackage: hasura
  envFrom:
  - secretRef:
      name: hasura-configmap

jobs:
  ~chart: jobs
  runs:
    build-app:
      use: SocialGouv/kontinuous/plugins/contrib/jobs/build
      needs: [hasura]
      with:
        imagePackage: app
    build-hasura:
      use: SocialGouv/kontinuous/plugins/contrib/jobs/build
      with:
        imagePackage: hasura
        context: packages/hasura
