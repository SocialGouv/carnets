// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`generate development k8s manifests 1`] = `
"---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    app.github.com/job: '5678'
    app.github.com/ref: refs/heads/mybranch
    app.github.com/repo: socialgouv/carnets
    app.github.com/run: '1234'
    app.github.com/sha: '0123456'
  labels:
    app: carnets
    application: carnets
    component: carnets
    owner: carnets
    team: carnets
    cert: wildcard
  name: carnets
  namespace: carnets-mybranch
spec:
  replicas: 1
  selector:
    matchLabels:
      app: carnets
  template:
    metadata:
      annotations:
        kapp.k14s.io/disable-default-ownership-label-rules: ''
        kapp.k14s.io/disable-default-label-scoping-rules: ''
        app.github.com/job: '5678'
        app.github.com/ref: refs/heads/mybranch
        app.github.com/repo: socialgouv/carnets
        app.github.com/run: '1234'
        app.github.com/sha: '0123456'
      labels:
        app: carnets
        application: carnets
        component: carnets
        owner: carnets
        team: carnets
        cert: wildcard
    spec:
      containers:
        - image: >-
            ghcr.io/socialgouv/fabrique/carnets:sha-0123456789abcdefghijklmnopqrstuvwxyz0123
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 30
            periodSeconds: 5
            timeoutSeconds: 5
          name: carnets
          ports:
            - containerPort: 3000
              name: http
          readinessProbe:
            failureThreshold: 15
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 0
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            limits:
              cpu: 200m
              memory: 256Mi
            requests:
              cpu: 50m
              memory: 128Mi
          startupProbe:
            failureThreshold: 12
            httpGet:
              path: /healthz
              port: http
            periodSeconds: 5
          envFrom:
            - secretRef:
                name: app-sealed-secret
            - configMapRef:
                name: carnets-configmap
          env:
            - name: APP_BASE_URL
              value: https://carnets-mybranch.dev2.fabrique.social.gouv.fr
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  annotations:
    sealedsecrets.bitnami.com/cluster-wide: 'true'
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    app.github.com/job: '5678'
    app.github.com/ref: refs/heads/mybranch
    app.github.com/repo: socialgouv/carnets
    app.github.com/run: '1234'
    app.github.com/sha: '0123456'
  name: app-sealed-secret
  namespace: carnets-mybranch
  labels:
    application: carnets
    component: carnets
    owner: carnets
    team: carnets
    cert: wildcard
spec:
  encryptedData:
    SENTRY_DSN: >-
      AgC1yaZRHjGptW3BY7qUKsHAoXScEjA+mht1Dm0kahzJsb9NDU1FhVBvZvVxbTjo5cINlvkT+v3jHwEP+Xcvz9uqHQuuQ5Pxiz4/QkteOg+iiCLP3KJzl9SLmq6Ukc7wgmOXaVa3U8y3brOF2r/PW77zP9m7zfWLJHIAY5xoyV8fLcwo21nE9peJmS8pw6SzoTzDHWr3kFVHqLKmgBAzkgcbDZ2ZcK1ypkdnkkmpFobJWROfmVZuQmgu5f24vTypJU4qogt9Bvm1UTIVMzqo3QhKi9MVJVauQbjfd9zPkKV6sHHDJL4TTo8mzowNW8Zur9HDkP3j77OHbvKO+KVSayjOimBAPs2pPBDM8V1uIZ54YCp1VPNPsVjZng58ZyXPgilBXmVAq2UT3BqELe0y1wLqWz7YUp2AllIOYNDt9ZKCrkXAI8MHImcq3OnjO/uBGrSe4y4zdlCy+K4c+3Nj6WqlQuaC5u+DbFxn9Q/ttvMnAHoeox1zQCPpGzlStol7of8FCSd+/2tbob19DuOX9+wnTEeDPI5GFlZ6pllEg7/ct/wPQRVC72YKbsLJ321v3vtaAlCcmPZTEAPjJKsTL8t1N+YqfoJyhpFw3zDxuHKPoaB5xshGn99xiNKZBexzn9E9YhSpZJUgnvj9IISfSIFRiMUEe9n3JkXLiCpnaUge1JmVwYezDpsvd8McIwdgayTL0lmuuSQ7KGZwQT+uN6tqBzFNWRQBIsTcamw7IFXELjLgS+7n3swrmALSaLRte1QI8bNszSqpY0z/3/CQPi/AFjHVuOZDTZBbkw==
    HASURA_JWT_KEY: >-
      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
    GITHUB_ID: >-
      AgAyeqDTzcB3aGCIft0tZ9dbxUkzJeD6jaToqG8dBf7bFerc3rGZ5cwJkNrdylrMzR9uYKu60fmBqrCukHgkZByrwCWHvu1dRUbnrNTQBrCdvCUL/L0bioRnU0gelkVswTAG9uk+PrIaF9FZisI35NxQzDQ7Pjpn1v5lEWuoXr9CY5K2EXJpThrJTW+kBUOkCzfwUr9n30SjUi85HJXDqmp4ATlcaL+16dJkvndWonQKZKIprdRcH6b/Qjc+3YXtS6mmm7ZB6EAJ8pHaRQhq3HvhzxHfpYRt+qc4H1qmgB4ANnHUn/+hhfM3Wc7ZulSbNCWUkTYYR/7v54BeRP9vhACCXqfWiufetPRN0lujoffbCowptUl34atFalAnQuKJCb1YNnBaKIXz4p3dzzCxG7r484CKkQ52QNJInIjIc90C0XgKPrePuR/W0G+2+bQC3zy+8TkXBuuD66IAeGoIhiFBIRdksHotvq6JZ+hgZfdj7xvcRUfYJYTIaaJot+5uv4IAL9k7l43J/ZgSi7VyXcxpv2U5zTgdpi3gTpjqWCzHnNqE1jUphO+yNo6IgRya5qhAKG1fsZejUBOqf9wnT2Qlj+5yvSrq9xgiGYJMlQqTpLrsuwOxq3p3aRZa8RoNzUs/WxQIEeTFhNshawCnGO2TRpU/rKHgSz4INkuRJ/rY3DxWrWG6KWok+IyAx/olITX/wcbWUkMUnnKFFAAu9KraC+gZMQ==
    GITHUB_SECRET: >-
      AgBViDaveeIbURz5uC7+C+ZSDYbQu9XXasshOADPNcyB6aCvbTQicKw6ebyhEPHsmLinMvENXOCUOQ7dWqPjBqMZyKd+wFGYcmrX1LYJUdWtMIHZSk193NHmhzHfhnUr7SCuIFNM3F6Ar4PKAFIalCqaIEy/GGeMuYRcv2PKdqIJ4YLsWvVCLsT4NvJAe28YvLe2doRybB+nMjq9YGNx5BsCz34k7KARqz2xjxEXUbF4jWWzw+QMa+90Lo0duzNUrasWx5howQCDGnryQ4oNVVQUh/Qz4qqhoh6+S2OWAocRYxGGivJmYTnvumaeUGb0POw5cGiQ4qEyt5MKLqLjBX+YpMCAG1tKKboOQ7MTtbSWF0WJMFzq8Ig47f389+rZsOY5bYQ05xUcrIWcNBD0KYKccF7//5ByoaDqGa/mE62lMb5KOG/yHD+nUxSk05Eo9W6jlDtQNhKoVFxmmYjvh4pJAtu9L2puEcBnobXL6nzsiABI+cm/qh9OXpwIyUwNqi1TxIyF8ADXMAWg/DRVAXivLrWGjr7P5G2bj39jpkSTmTdDw0tZs13xl+iXYhWwwEREY9qFA/CFK8eL7GTHfPQmcitGmOsOB1Gkbqm53krZTJd8BQxOyKVkZlhnTY8n8vUh0iVi/720D9fwEFllQ3QqXjv3l2/QEXphTnmG9SRmDCjESsjpvgwZXE8JfC3G6BvvtvZzIIYTeLl0ewfGbe4JMk3WHBcgPaRD9gBBwZEQ8FUzNZB7NkBF
  template:
    metadata:
      annotations:
        sealedsecrets.bitnami.com/cluster-wide: 'true'
        kapp.k14s.io/disable-default-ownership-label-rules: ''
        kapp.k14s.io/disable-default-label-scoping-rules: ''
        app.github.com/job: '5678'
        app.github.com/ref: refs/heads/mybranch
        app.github.com/repo: socialgouv/carnets
        app.github.com/run: '1234'
        app.github.com/sha: '0123456'
      name: app-sealed-secret
      labels:
        application: carnets
        component: carnets
        owner: carnets
        team: carnets
        cert: wildcard
    type: Opaque
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: carnets-configmap
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    app.github.com/job: '5678'
    app.github.com/ref: refs/heads/mybranch
    app.github.com/repo: socialgouv/carnets
    app.github.com/run: '1234'
    app.github.com/sha: '0123456'
  labels:
    application: carnets
    component: carnets
    owner: carnets
    team: carnets
    cert: wildcard
  namespace: carnets-mybranch
data:
  NODE_ENV: production
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: carnets
    application: carnets
    component: carnets
    owner: carnets
    team: carnets
    cert: wildcard
  name: carnets
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    app.github.com/job: '5678'
    app.github.com/ref: refs/heads/mybranch
    app.github.com/repo: socialgouv/carnets
    app.github.com/run: '1234'
    app.github.com/sha: '0123456'
  namespace: carnets-mybranch
spec:
  ports:
    - name: http
      port: 80
      targetPort: 3000
  selector:
    app: carnets
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: nginx
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    app.github.com/job: '5678'
    app.github.com/ref: refs/heads/mybranch
    app.github.com/repo: socialgouv/carnets
    app.github.com/run: '1234'
    app.github.com/sha: '0123456'
  labels:
    app: carnets
    application: carnets
    component: carnets
    owner: carnets
    team: carnets
    cert: wildcard
  name: carnets
  namespace: carnets-mybranch
spec:
  rules:
    - host: carnets-mybranch.dev2.fabrique.social.gouv.fr
      http:
        paths:
          - backend:
              service:
                name: carnets
                port:
                  name: http
            path: /
            pathType: Prefix
  tls:
    - hosts:
        - carnets-mybranch.dev2.fabrique.social.gouv.fr
      secretName: wildcard-crt
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    app.github.com/job: '5678'
    app.github.com/ref: refs/heads/mybranch
    app.github.com/repo: socialgouv/carnets
    app.github.com/run: '1234'
    app.github.com/sha: '0123456'
  labels:
    app: hasura
    application: carnets
    component: hasura
    owner: carnets
    team: carnets
    cert: wildcard
  name: hasura
  namespace: carnets-mybranch
spec:
  replicas: 1
  selector:
    matchLabels:
      app: hasura
  template:
    metadata:
      annotations:
        kapp.k14s.io/disable-default-ownership-label-rules: ''
        kapp.k14s.io/disable-default-label-scoping-rules: ''
        app.github.com/job: '5678'
        app.github.com/ref: refs/heads/mybranch
        app.github.com/repo: socialgouv/carnets
        app.github.com/run: '1234'
        app.github.com/sha: '0123456'
      labels:
        app: hasura
        application: carnets
        component: hasura
        owner: carnets
        team: carnets
        cert: wildcard
    spec:
      containers:
        - image: >-
            ghcr.io/socialgouv/fabrique/hasura:sha-0123456789abcdefghijklmnopqrstuvwxyz0123
          livenessProbe:
            failureThreshold: 6
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 30
            periodSeconds: 5
            timeoutSeconds: 5
          name: hasura
          ports:
            - containerPort: 80
              name: http
          readinessProbe:
            failureThreshold: 15
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 0
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 1
          resources:
            limits:
              cpu: 500m
              memory: 512Mi
            requests:
              cpu: 100m
              memory: 64Mi
          startupProbe:
            failureThreshold: 12
            httpGet:
              path: /healthz
              port: http
            periodSeconds: 5
          envFrom:
            - secretRef:
                name: azure-pg-user-mybranch
            - secretRef:
                name: hasura-sealed-secret
            - configMapRef:
                name: hasura-configmap
      initContainers:
        - env:
            - name: WAIT_FOR_RETRIES
              value: '24'
          envFrom:
            - secretRef:
                name: azure-pg-user-mybranch
          image: ghcr.io/socialgouv/docker/wait-for-postgres:6.56.1
          imagePullPolicy: Always
          name: wait-for-postgres
          resources:
            limits:
              cpu: 20m
              memory: 32Mi
            requests:
              cpu: 5m
              memory: 16Mi
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  annotations:
    sealedsecrets.bitnami.com/cluster-wide: 'true'
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    app.github.com/job: '5678'
    app.github.com/ref: refs/heads/mybranch
    app.github.com/repo: socialgouv/carnets
    app.github.com/run: '1234'
    app.github.com/sha: '0123456'
  name: hasura-sealed-secret
  namespace: carnets-mybranch
  labels:
    application: carnets
    component: hasura
    owner: carnets
    team: carnets
    cert: wildcard
spec:
  encryptedData:
    GITHUB_AUTHORIZATION_HEADER: >-
      AgCWyvWgTRzgmAJdXuu+0ru/7Phfp2voj7QmIhZmN67V3mAasqA0EMZ90qc6T6lUZrytD65bCeU+eZL6U+OMHtvqz1dZ5o3aF1+zN97rtNuVQAN6c/iUVozRtCaz9eHAjpDHenUJZxE10rsGwgL8uWimWnl8x5tnP7cvcDOYn3OeKyflcRsSMm52Yx7IIHUQYkttmLyoycxi8EHAv6S3iQraOCYhYCRzLSWEwS3WpNjEGa81q7VG4QJ9mSPYXta51ZlXX8qPekLZJ72PPNTWA5RKYv6MYHKRJwuvs3/Ry98jvhz9JB+5ccYMYQyb1NQvSsA+ORv1zYoPJuxuqh1B7jLD+RFlg+BFQtFtyGgN6PET+epNs5aeb+fWSeAfkxn9+HLHPpKokq34fQboNeESdOXAaRu7G2N/OWTPgGRW8OIPO8Mww75OCvB+9+mD5wuQtSg3GOOa2JTkrhkLU3260eaeYe9INmxKLVe6z7GXQTAS0S2EmXYH13DHXIEqB8erMab077Akk+7CPDWgAp5xyFWtZfjV5cE3EI/PSWFr/ucbjUBjJPVzrpMiq9uYTsJPenJ/Y74LBLqe/CL1vNjtYJ7O7o3GFTRa6ZNsGnWhfZedCSgnOlX3F0+og1zd/NDWjkrs5KPtw5OuMwEQ7JVyq859FrCqZFh+g3Ri5Z5wNf2j2Fbf/bspcj2BeOL3qJgC2zvhX7irBomRro5Hh68W/rqIVZRlC4qjYhPrQ0meVtGE8vWP679G6yixXFDiTxNpPg==
    HASURA_GRAPHQL_ADMIN_SECRET: >-
      AgCcb5mXRwJjvRORs39EBaxRar1oji8NaKg6X7XHbVGc2RnmXuc5RDMw0n7/DD92ev8eO/kAjZ2si6eaF+DEc+Prq6rZUKZNV3xequsD6oUGkfRCkifayPfP5TY5LVgLMcoD8w7Gk+xn6dzO3CjJxuSCeiSwqy/v0lNyjMkDD4RYpVfZrVhQ97EGM5KDjt0ZWR0Bd3Cje50Fi1LiY6P/HnNy94qAcayf8hM1e/R6nhNY/9nWa6GpEtX44pbhM4JiLoaamSb6VIGV38rvhU6KGMNAEQwUvdyKFrDnFKZGG0Yb+L0FiF0391TpQ28YYmUV06r6zXDgO/KVPRHFumUmHqOzOXQ4S/rJBJy5Hk7IRCjmEb7gfO0bGCrDglQYfF1ZhCJoMCMvuCVTfSTqYKH8EQnPjDMXdwC/2XN9HEwkgN4YysAi8lJgw7SBjsuvMOWnGWZmCtmonfyG4+Slx8kW8HFNG/i22d4WfSETZ6Nd062pa97lZzrNYt0xWbE4yT0LaR67yGkIB6QdRLU7dHWltmnWz2gA8ARdcevypAwDSgpjzVZSJV4yPzX1KXCAEspt8w31eR+ULpFx+RaGNgeWT1JuqBHy5gUBY0dcKU1IMhsdJFRyDcYsQcZvhFM0qGZNGeWpaDbRO5c+pNPFIoy0v8b97JOa2Ec2mQdV5dNrV+904SDKCc/pOsMzKuTxm3hj+aT5fA2NHNg9Hf15Zlg+ew==
    HASURA_GRAPHQL_JWT_SECRET: >-
      AgCfEkErPSA4xorFHix///r7bJAZGS27hqAvJ7fBqYUalLaxQtxiFPJ+wSSC69AbolUdt29G4PWv9LKRph0dnvxZBSZAnAjTv0SAnVJlWhdRYw9LiY4DeH1Xwuo7SbN5GvuoWFxu05Ai3+am8+uQaoHvl6yeZ/mkEg2J71zN7CUaAMu4rLAXKBDksoN5AMoBbKbd+1hxvtankV4g/ugRZaTNbQqdHcamrCVKKKVgNDyR8wHYzpNDiQtrbTtK6hcqJQiH6mnFVoQaAzhtinv6mXveX3X5T5553Zs0/a/+XcUE8fgZzwK2hHZVPqrg5yZGiwr2r9/qV7c7XS0rr/voYy4qtxvnScL1xGlTigSHOh3/FsGwHwfq9r1PxWH+mHefSoqQ58U72PvFOke3VHx8VCLdHMu3HzYfui5p8qLwNVb+msYQmTo+XAPb6kjYeg6uBwXmn4ShyAUoz/cx70YS3WpUbISEsGF5U7Cz8nj+YBpfSNuFbl2p/cFVFQshG50M2EyyoKBs+UHn+zag40abXxnFG0/RnqBfZdpzLaYGk8E0wtgUM9hLaOALu75q0UtVgZMQgNJEDclbUxe6ycJH1RsBt3zbTf/d93Y28xVkvSAKB9XkhAOJma/9OWoHKAVgYc8h+ruFjSMH/NbWWPpP4pUGOrcbicKKmbNW7HRwpONV5vVzDiWwLgR2BG1brWhr/uwh6u4Ix2LOE0wtQ0aFpzMHWnVQ28nijtCdkECZKf25ByfZTdh/4x83C/hIxvJVi9kpeROtkscf0oRZEBd6jll69OAxqGXNsoRxadvvVb7w3+TXei4T9nCAEH5bEvr1ZhkmBHuLexDskhYRu1rHfzHEhqVlTUCLEt9HiyTi7kOGSZWoGtvqh9T2c8n8s96BNSrKsq/05kOZ/KKyOaHdlhCKEXvgN/vPVbPfH7djKLl++cWJcEa4UKAOmrLynKS5SzLv8UiZ/VhL22+ILPXmzjl3ZIJtB1UDsFe9MiyvIN4tmFCAnpvrV+3udeTHPE9Q36j0mzOaw+gIN2MDHG6ZoOEGRgArWU6VwVWdYBrGHnKxhFvInOB51Ti/Rlt7bBHGrWO/P6ybvVPyJOhROPq8HOC4Tg4FCNekJ69gBDwc5hE+dOM4r6FaDk2rjppgRhZxIlJ5qvATpFf9fmZuF9cXn7YsvJ81d49dYYMxnqHiF/Elpsq0Nmo5eZuNX++Fy+gCxm04TfoBnDit6gg8Ei3r7pgiCeo7e5bZu807dIftUhX8Zgzua1XgXGErw2eBz30oM0NoD1PONCVy6181NOUmb6PTR9elP3QP4vWLnsoa/8RRaDn04D98uVW6i/yyxjQYq+VBOUJU/CfwX/m92qSx7iMKvnTcqLdDZDDmkIUWszi3Kk1bk2PbMw0dCmXArsW78qx0cjfdDZhc+zigwf20pAbGZt9qEfHpRcV04Wc2JynVYQhkjoJz2OWZjULUGZ3UbP9HziBvPI0TqFY2xF3Ei66LV+veODjmF94u13X+BFxaEgARFCzWk9PgSpLwgkEbsHmx3cA3OloRHIV3huFp1DsD6l203jKMwT8DRaNLhNs2+LzNvghbpvBZUp2Gtvxy4p5kJyG9WKDu2Z7si10wFODudiDJtjZq7CqLKMluqebIuFW09PVSZmnDqTfdk06JjdsBRArKPlIlPFJsZpQ9H/7YGpijGT0ac3fJ4MzpHBDn02sjXMO1kDOiCXDYYeXyOa88gRBgwRpZuF+n288K+mwjxe/XTd+PEY84NzZ4UsAmDEqNTjbYGWKmmrjPh/rs9zUDCMi6T00HLiPtb2X7FHxVTO9ZQ2Np+Q==
  template:
    metadata:
      annotations:
        sealedsecrets.bitnami.com/cluster-wide: 'true'
        kapp.k14s.io/disable-default-ownership-label-rules: ''
        kapp.k14s.io/disable-default-label-scoping-rules: ''
        app.github.com/job: '5678'
        app.github.com/ref: refs/heads/mybranch
        app.github.com/repo: socialgouv/carnets
        app.github.com/run: '1234'
        app.github.com/sha: '0123456'
      name: hasura-sealed-secret
      labels:
        application: carnets
        component: hasura
        owner: carnets
        team: carnets
        cert: wildcard
    type: Opaque
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: hasura-configmap
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    app.github.com/job: '5678'
    app.github.com/ref: refs/heads/mybranch
    app.github.com/repo: socialgouv/carnets
    app.github.com/run: '1234'
    app.github.com/sha: '0123456'
  labels:
    application: carnets
    component: hasura
    owner: carnets
    team: carnets
    cert: wildcard
  namespace: carnets-mybranch
data:
  HASURA_GRAPHQL_SERVER_PORT: '80'
  HASURA_GRAPHQL_LOG_LEVEL: debug
  HASURA_GRAPHQL_NO_OF_RETRIES: '5'
  HASURA_GRAPHQL_ENABLE_CONSOLE: 'false'
  HASURA_GRAPHQL_UNAUTHORIZED_ROLE: anonymous
  HASURA_GRAPHQL_ENABLED_LOG_TYPES: startup, http-log, webhook-log, websocket-log, query-log
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: hasura
    application: carnets
    component: hasura
    owner: carnets
    team: carnets
    cert: wildcard
  name: hasura
  annotations:
    kapp.k14s.io/disable-default-ownership-label-rules: ''
    kapp.k14s.io/disable-default-label-scoping-rules: ''
    app.github.com/job: '5678'
    app.github.com/ref: refs/heads/mybranch
    app.github.com/repo: socialgouv/carnets
    app.github.com/run: '1234'
    app.github.com/sha: '0123456'
  namespace: carnets-mybranch
spec:
  ports:
    - name: http
      port: 80
      targetPort: 80
  selector:
    app: hasura
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: netpol-carnets-mybranch
  namespace: carnets-mybranch
spec:
  ingress:
    - from:
        - podSelector: {}
    - from:
        - namespaceSelector:
            matchLabels:
              network-policy/source: ingress-controller
    - from:
        - namespaceSelector:
            matchLabels:
              network-policy/source: monitoring
  podSelector: {}
  policyTypes:
    - Ingress
---
apiVersion: batch/v1
kind: Job
spec:
  backoffLimit: 5
  template:
    spec:
      containers:
        - command:
            - create-db-user
          env:
            - name: NEW_DB_NAME
              value: autodevops_mybranch
            - name: NEW_USER
              value: user_mybranch
            - name: NEW_PASSWORD
              value: password_mybranch
            - name: NEW_DB_EXTENSIONS
              value: hstore pgcrypto citext uuid-ossp postgis
          envFrom:
            - secretRef:
                name: azure-pg-admin-user
          image: ghcr.io/socialgouv/docker/azure-db:6.56.1
          imagePullPolicy: IfNotPresent
          name: create-db-user
          resources:
            limits:
              cpu: 300m
              memory: 256Mi
            requests:
              cpu: 100m
              memory: 64Mi
      restartPolicy: Never
  ttlSecondsAfterFinished: 86400
metadata:
  annotations:
    kapp.k14s.io/update-strategy: skip
    app.github.com/job: '5678'
    app.github.com/ref: refs/heads/mybranch
    app.github.com/repo: socialgouv/carnets
    app.github.com/run: '1234'
    app.github.com/sha: '0123456'
  labels:
    application: carnets
    component: carnets
    owner: carnets
    team: carnets
    cert: wildcard
  name: create-db-job-mybranch
  namespace: carnets-mybranch
---
apiVersion: v1
kind: Secret
stringData:
  DATABASE_URL: >-
    postgresql://user_mybranch%40carnetsdevserver.postgres.database.azure.com:password_mybranch@carnetsdevserver.postgres.database.azure.com/autodevops_mybranch?sslmode=require
  DB_URI: >-
    postgresql://user_mybranch%40carnetsdevserver.postgres.database.azure.com:password_mybranch@carnetsdevserver.postgres.database.azure.com/autodevops_mybranch?sslmode=require
  HASURA_GRAPHQL_DATABASE_URL: >-
    postgresql://user_mybranch%40carnetsdevserver.postgres.database.azure.com:password_mybranch@carnetsdevserver.postgres.database.azure.com/autodevops_mybranch?sslmode=require
  PGDATABASE: autodevops_mybranch
  PGHOST: carnetsdevserver.postgres.database.azure.com
  PGPASSWORD: password_mybranch
  PGRST_DB_URI: >-
    postgresql://user_mybranch%40carnetsdevserver.postgres.database.azure.com:password_mybranch@carnetsdevserver.postgres.database.azure.com/autodevops_mybranch?sslmode=require
  PGSSLMODE: require
  PGUSER: user_mybranch@carnetsdevserver.postgres.database.azure.com
metadata:
  annotations:
    kapp.k14s.io/update-strategy: skip
    app.github.com/job: '5678'
    app.github.com/ref: refs/heads/mybranch
    app.github.com/repo: socialgouv/carnets
    app.github.com/run: '1234'
    app.github.com/sha: '0123456'
  labels:
    application: carnets
    component: carnets
    owner: carnets
    team: carnets
    cert: wildcard
  name: azure-pg-user-mybranch
  namespace: carnets-mybranch
"
`;
